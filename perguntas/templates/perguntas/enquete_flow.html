{% extends 'base.html' %}
{% block title %}Enquetes{% endblock %}
{% block content %}
    <h2>Enquetes Ativas</h2>
    {% if enquetes %}
        <ul>
            {% for enquete in enquetes %}
                <li>
                    <a href="{% url 'responder_enquete' enquete.id %}">{{ enquete.titulo|upper }}</a> (Criada em: {{ enquete.data_criacao|date:"d/m/Y" }})
                    {% if enquete.encerrada %} <span style="color:red;">(Encerrada)</span> {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Nenhuma enquete ativa no momento.</p>
    {% endif %}

    <hr>

    {% if form %}
        <h3>Responder Enquete: {{ enquete.titulo|default:"Selecionar uma enquete" }}</h3>
        <form method="post" class="styled-form">
            {% csrf_token %}
            {% include 'perguntas/form_errors.html' with form=form %}
            {{ form.as_p }}
            <button type="submit" class="styled-button">Enviar Respostas</button>
        </form>
    {% endif %}

    <hr>

    {% if resultados %}
        <h3>Resultados da Enquete: {{ enquete.titulo|default:"Resultados" }}</h3>
        {% for resultado in resultados %}
            <div class="resultado-pergunta">
                <h4>{{ resultado.pergunta|lower|capfirst }}</h4>
                {% if resultado.opcoes %}
                    <ul>
                        {% for opcao_resultado in resultado.opcoes %}
                            <li>{{ opcao_resultado.opcao }}: {{ opcao_resultado.porcentagem|default:"0%" }} ({{ opcao_resultado.contagem }} votos)</li>
                        {% endfor %}
                    </ul>
                {% elif resultado.respostas_texto %}
                    <ul>
                        {% for resposta in resultado.respostas_texto|slice:":5" %} <li>{{ resposta|default:"Nenhuma resposta" }}</li>
                        {% empty %}
                            <li>Nenhuma resposta de texto livre ainda.</li>
                        {% endfor %}
                        {% if resultado.respostas_texto|length > 5 %}
                            <p><a href="#">Ver todas as respostas ({{ resultado.respostas_texto|length }})</a></p>
                        {% endif %}
                    </ul>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}

    <a href="{% url 'index' %}" class="back-link">Voltar para a p√°gina inicial</a>
{% endblock %}